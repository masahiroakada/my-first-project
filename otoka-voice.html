<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ãŠã¨ã‹ã¡ã‚ƒã‚“ã®ã‚¢ãƒ—ãƒª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    body {
      font-family: "Hiragino Kaku Gothic ProN", "Rounded Mplus 1c", sans-serif;
      overflow: hidden;
      min-height: 100vh;
      min-height: 100dvh;
      background: #fef3e2;
    }

    /* --- å…±é€š --- */
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 20px;
    }
    .screen.active { display: flex; }

    /* --- ãƒ›ãƒ¼ãƒ ç”»é¢ --- */
    #home {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
    }

    .home-title {
      font-size: 1.8rem;
      color: #e44d7b;
      margin-bottom: 8px;
    }

    .home-name {
      font-size: 3rem;
      color: #ff6b9d;
      margin-bottom: 30px;
      animation: bounce 1.5s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }

    .menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      max-width: 340px;
      width: 100%;
    }

    .menu-btn {
      background: #fff;
      border: none;
      border-radius: 24px;
      padding: 24px 12px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      transition: transform 0.15s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .menu-btn:active { transform: scale(0.92); }
    .menu-btn .icon { font-size: 3rem; }
    .menu-btn .label { color: #555; font-weight: 600; }

    /* --- æˆ»ã‚‹ãƒœã‚¿ãƒ³ --- */
    .back-btn {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 100;
      background: rgba(255,255,255,0.85);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      display: none;
    }
    .back-btn.show { display: block; }

    /* --- ã©ã†ã¶ã¤ã‚²ãƒ¼ãƒ  --- */
    #animals {
      background: linear-gradient(135deg, #a8edea, #fed6e3);
    }

    .animals-title {
      font-size: 1.5rem;
      color: #4a6fa1;
      margin-bottom: 20px;
    }

    .animal-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      max-width: 360px;
      width: 100%;
    }

    .animal-btn {
      background: #fff;
      border: none;
      border-radius: 20px;
      padding: 16px 8px;
      font-size: 3rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.15s;
      position: relative;
    }

    .animal-btn:active { transform: scale(0.9); }

    .animal-btn .animal-name {
      display: block;
      font-size: 0.85rem;
      color: #888;
      margin-top: 4px;
    }

    .animal-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: #fff;
      border-radius: 30px;
      padding: 40px;
      text-align: center;
      z-index: 200;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .animal-popup.show { transform: translate(-50%, -50%) scale(1); }
    .animal-popup .big-emoji { font-size: 6rem; }
    .animal-popup .sound-text {
      font-size: 2rem;
      color: #e44d7b;
      margin-top: 10px;
      font-weight: 700;
    }

    /* --- ã„ã‚ã‚ãã³ --- */
    #colors {
      background: linear-gradient(135deg, #fbc2eb, #a6c1ee);
    }

    .colors-title {
      font-size: 1.5rem;
      color: #7b5ea7;
      margin-bottom: 10px;
    }

    .color-question {
      font-size: 1.3rem;
      color: #555;
      margin-bottom: 20px;
    }

    .color-target {
      font-size: 1.6rem;
      font-weight: 700;
    }

    .color-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      max-width: 320px;
      width: 100%;
    }

    .color-btn {
      width: 90px;
      height: 90px;
      border: 4px solid #fff;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.15s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      justify-self: center;
    }
    .color-btn:active { transform: scale(0.9); }

    .color-result {
      margin-top: 20px;
      font-size: 2.5rem;
      min-height: 3rem;
    }

    .color-score {
      margin-top: 10px;
      font-size: 1.2rem;
      color: #7b5ea7;
    }

    /* --- ãµã†ã›ã‚“ã‚²ãƒ¼ãƒ  --- */
    #balloons {
      background: linear-gradient(180deg, #87ceeb, #e0f7ff);
      position: relative;
      overflow: hidden;
    }

    .balloon-score {
      position: fixed;
      top: 16px;
      right: 16px;
      background: rgba(255,255,255,0.85);
      border-radius: 16px;
      padding: 8px 16px;
      font-size: 1.2rem;
      font-weight: 700;
      color: #e44d7b;
      z-index: 100;
    }

    .balloon {
      position: absolute;
      font-size: 3.5rem;
      cursor: pointer;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15));
      transition: transform 0.1s;
    }
    .balloon:active { transform: scale(1.3); }

    @keyframes floatUp {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(-110vh); opacity: 1; }
    }

    .pop-effect {
      position: absolute;
      font-size: 2rem;
      pointer-events: none;
      animation: popAnim 0.6s forwards;
    }

    @keyframes popAnim {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    /* --- ãŠãˆã‹ã --- */
    #drawing {
      background: #fff;
      padding: 0;
    }

    .draw-toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 100;
      flex-wrap: wrap;
    }

    .draw-color {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid #ddd;
      cursor: pointer;
    }
    .draw-color.active { border-color: #333; box-shadow: 0 0 0 2px #333; }

    .draw-clear {
      background: #ff6b6b;
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
    }

    canvas {
      display: block;
      touch-action: none;
    }

    /* --- æ˜Ÿã‚¨ãƒ•ã‚§ã‚¯ãƒˆ --- */
    .star-burst {
      position: fixed;
      pointer-events: none;
      z-index: 300;
      font-size: 1.5rem;
      animation: starPop 0.8s forwards;
    }

    @keyframes starPop {
      0% { transform: scale(0) rotate(0deg); opacity: 1; }
      50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
      100% { transform: scale(0.5) rotate(360deg) translateY(-60px); opacity: 0; }
    }
  </style>
</head>
<body>

  <button class="back-btn" id="backBtn" onclick="goHome()">ğŸ </button>

  <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
  <div class="screen active" id="home">
    <div class="home-title">ã‚ˆã†ã“ãï¼</div>
    <div class="home-name" onclick="speak('ãŠã¨ã‹ã¡ã‚ƒã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ãã‚‡ã†ã‚‚ã€ã„ã£ã—ã‚‡ã«ã€ã‚ãã¼ã†ã­ï¼')">ğŸŒŸ ãŠã¨ã‹ã¡ã‚ƒã‚“ ğŸŒŸ</div>
    <div class="menu">
      <button class="menu-btn" onclick="goScreen('animals')">
        <span class="icon">ğŸ¾</span>
        <span class="label">ã©ã†ã¶ã¤</span>
      </button>
      <button class="menu-btn" onclick="goScreen('colors')">
        <span class="icon">ğŸ¨</span>
        <span class="label">ã„ã‚ã‚ãã³</span>
      </button>
      <button class="menu-btn" onclick="goScreen('balloons')">
        <span class="icon">ğŸˆ</span>
        <span class="label">ãµã†ã›ã‚“</span>
      </button>
      <button class="menu-btn" onclick="goScreen('drawing')">
        <span class="icon">âœï¸</span>
        <span class="label">ãŠãˆã‹ã</span>
      </button>
    </div>
  </div>

  <!-- ã©ã†ã¶ã¤ -->
  <div class="screen" id="animals">
    <div class="animals-title">ã©ã†ã¶ã¤ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã­ï¼</div>
    <div class="animal-grid" id="animalGrid"></div>
    <div class="animal-popup" id="animalPopup">
      <div class="big-emoji" id="popupEmoji"></div>
      <div class="sound-text" id="popupSound"></div>
    </div>
  </div>

  <!-- ã„ã‚ã‚ãã³ -->
  <div class="screen" id="colors">
    <div class="colors-title">ã„ã‚ã‚ãã³</div>
    <div class="color-question">
      <span class="color-target" id="colorTarget"></span><br>ã¯ã©ã‚Œã‹ãªï¼Ÿ
    </div>
    <div class="color-grid" id="colorGrid"></div>
    <div class="color-result" id="colorResult"></div>
    <div class="color-score" id="colorScore"></div>
  </div>

  <!-- ãµã†ã›ã‚“ -->
  <div class="screen" id="balloons">
    <div class="balloon-score">â­ <span id="balloonScore">0</span></div>
  </div>

  <!-- ãŠãˆã‹ã -->
  <div class="screen" id="drawing">
    <canvas id="drawCanvas"></canvas>
    <div class="draw-toolbar" id="drawToolbar"></div>
  </div>

  <script>
    /* ===== ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ===== */
    let currentScreen = 'home';
    let balloonInterval = null;

    /* ===== éŸ³å£°ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆçŸ­ãƒ•ãƒ¬ãƒ¼ã‚ºåˆ†å‰² + Google TTSï¼‰ ===== */
    let speakQueue = [];
    let isSpeaking = false;

    // ãƒ†ã‚­ã‚¹ãƒˆã‚’çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã«åˆ†å‰²ï¼ˆçŸ­ã„æ–¹ãŒæŠ‘æšãŒè‡ªç„¶ã«ãªã‚‹ï¼‰
    function splitPhrases(text) {
      return text
        .split(/(?<=[ã€ã€‚ï¼ï¼Ÿ])/)
        .map(s => s.trim())
        .filter(s => s.length > 0);
    }

    function speak(text) {
      // å†ç”Ÿä¸­ã‚’å…¨ã¦æ­¢ã‚ã‚‹
      speakQueue = [];
      isSpeaking = false;
      if ('speechSynthesis' in window) speechSynthesis.cancel();

      const phrases = splitPhrases(text);
      speakQueue = phrases;
      playNext();
    }

    function playNext() {
      if (speakQueue.length === 0) { isSpeaking = false; return; }
      isSpeaking = true;
      const phrase = speakQueue.shift();

      const audio = new Audio();
      audio.src = 'https://translate.google.com/translate_tts'
        + '?ie=UTF-8&tl=ja&client=tw-ob&q=' + encodeURIComponent(phrase);

      audio.onended = () => {
        // ãƒ•ãƒ¬ãƒ¼ã‚ºé–“ã«è‡ªç„¶ãªé–“ã‚’å…¥ã‚Œã‚‹
        const pause = phrase.endsWith('ï¼') || phrase.endsWith('ï¼Ÿ') ? 350 : 200;
        setTimeout(playNext, pause);
      };

      audio.play().catch(() => {
        // Google TTSãŒä½¿ãˆãªã„å ´åˆã¯Web Speech APIã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        fallbackSpeak(phrase, () => {
          const pause = phrase.endsWith('ï¼') || phrase.endsWith('ï¼Ÿ') ? 350 : 200;
          setTimeout(playNext, pause);
        });
      });
    }

    function fallbackSpeak(text, onDone) {
      if (!('speechSynthesis' in window)) { if (onDone) onDone(); return; }
      const voices = speechSynthesis.getVoices();
      const jaVoices = voices.filter(v => v.lang.startsWith('ja'));
      const priority = ['premium', 'enhanced', 'o-ren', 'hattori', 'kyoko', 'google'];
      let voice = null;
      for (const kw of priority) {
        voice = jaVoices.find(v => v.name.toLowerCase().includes(kw));
        if (voice) break;
      }
      if (!voice && jaVoices.length) voice = jaVoices[0];

      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ja-JP';
      if (voice) u.voice = voice;
      u.pitch = 1.1;
      u.rate = 0.9;
      if (onDone) u.onend = onDone;
      speechSynthesis.speak(u);
    }

    const screenGreetings = {
      animals: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼ã©ã†ã¶ã¤ã§ã€ã‚ãã¼ã†ï¼ã™ããªã®ã€ã‚¿ãƒƒãƒ—ã—ã¦ã­ï¼',
      colors: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼ã„ã‚ã‚ã¦ã‚¯ã‚¤ã‚ºã ã‚ˆï¼ãŒã‚“ã°ã£ã¦ã­ï¼',
      balloons: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼ãµã†ã›ã‚“ã‚’ã€ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚ã£ã¦ã­ï¼',
      drawing: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼ã™ããªãˆã‚’ã€ã‹ã„ã¦ã­ï¼',
    };

    function goScreen(name) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(name).classList.add('active');
      document.getElementById('backBtn').classList.toggle('show', name !== 'home');
      currentScreen = name;

      if (name === 'balloons') startBalloons();
      else stopBalloons();

      if (name === 'colors') startColorGame();
      if (name === 'drawing') initCanvas();

      if (screenGreetings[name]) {
        speak(screenGreetings[name]);
      }
    }

    function goHome() {
      goScreen('home');
      speak('ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼ãªã«ã—ã¦ã€ã‚ãã¶ï¼Ÿ');
    }

    /* ===== ã©ã†ã¶ã¤ ===== */
    const animalData = [
      { emoji: 'ğŸ¶', name: 'ã„ã¬', sound: 'ãƒ¯ãƒ³ãƒ¯ãƒ³ï¼' },
      { emoji: 'ğŸ±', name: 'ã­ã“', sound: 'ãƒ‹ãƒ£ãƒ¼ï¼' },
      { emoji: 'ğŸ·', name: 'ã¶ãŸ', sound: 'ãƒ–ãƒ¼ãƒ–ãƒ¼ï¼' },
      { emoji: 'ğŸ®', name: 'ã†ã—', sound: 'ãƒ¢ãƒ¼ãƒ¢ãƒ¼ï¼' },
      { emoji: 'ğŸ”', name: 'ã«ã‚ã¨ã‚Š', sound: 'ã‚³ã‚±ã‚³ãƒƒã‚³ãƒ¼ï¼' },
      { emoji: 'ğŸ¸', name: 'ã‹ãˆã‚‹', sound: 'ã‚±ãƒ­ã‚±ãƒ­ï¼' },
      { emoji: 'ğŸ˜', name: 'ãã†', sound: 'ãƒ‘ã‚ªãƒ¼ãƒ³ï¼' },
      { emoji: 'ğŸ¦', name: 'ã‚‰ã„ãŠã‚“', sound: 'ã‚¬ã‚ªãƒ¼ï¼' },
      { emoji: 'ğŸ¥', name: 'ã²ã‚ˆã“', sound: 'ãƒ”ãƒ¨ãƒ”ãƒ¨ï¼' },
    ];

    const animalGrid = document.getElementById('animalGrid');
    animalData.forEach(a => {
      const btn = document.createElement('button');
      btn.className = 'animal-btn';
      btn.innerHTML = `${a.emoji}<span class="animal-name">${a.name}</span>`;
      btn.onclick = () => showAnimal(a);
      animalGrid.appendChild(btn);
    });

    const animalMessages = [
      'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼{name}ã ã‚ˆï¼{sound}',
      '{name}ã•ã‚“ãŒã€{sound}ã£ã¦ã€ã„ã£ã¦ã‚‹ã‚ˆï¼',
      'ãŠã¨ã‹ã¡ã‚ƒã‚“ã¯ã€{name}ã€ã™ãï¼Ÿ{sound}',
      '{name}ã ã­ï¼ã„ã£ã—ã‚‡ã«ã€{sound}',
    ];

    function showAnimal(a) {
      document.getElementById('popupEmoji').textContent = a.emoji;
      document.getElementById('popupSound').textContent = a.sound;
      const popup = document.getElementById('animalPopup');
      popup.classList.add('show');

      const msg = animalMessages[Math.floor(Math.random() * animalMessages.length)]
        .replace('{name}', a.name)
        .replace('{sound}', a.sound);
      speak(msg);

      setTimeout(() => popup.classList.remove('show'), 3000);
    }

    /* ===== ã„ã‚ã‚ãã³ ===== */
    const colorData = [
      { name: 'ã‚ã‹', color: '#ff4757', text: '#ff4757' },
      { name: 'ã‚ãŠ', color: '#3498ff', text: '#3498ff' },
      { name: 'ãã„ã‚', color: '#ffd32a', text: '#d4a800' },
      { name: 'ã¿ã©ã‚Š', color: '#2ed573', text: '#2ed573' },
      { name: 'ã‚ªãƒ¬ãƒ³ã‚¸', color: '#ff9f43', text: '#ff9f43' },
      { name: 'ã‚€ã‚‰ã•ã', color: '#a55eea', text: '#a55eea' },
    ];

    let colorAnswer = null;
    let colorStreak = 0;

    function startColorGame() {
      colorStreak = 0;
      nextColorQuestion();
    }

    function nextColorQuestion() {
      const target = colorData[Math.floor(Math.random() * colorData.length)];
      colorAnswer = target;

      const targetEl = document.getElementById('colorTarget');
      targetEl.textContent = target.name;
      targetEl.style.color = target.text;

      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦è¡¨ç¤º
      const shuffled = [...colorData].sort(() => Math.random() - 0.5);
      const grid = document.getElementById('colorGrid');
      grid.innerHTML = '';
      shuffled.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'color-btn';
        btn.style.background = c.color;
        btn.onclick = (e) => checkColor(c, e);
        grid.appendChild(btn);
      });

      document.getElementById('colorResult').textContent = '';

      // å•é¡Œã‚’èª­ã¿ä¸Šã’ï¼ˆç”»é¢åˆ‡ã‚Šæ›¿ãˆæ™‚ã®æŒ¨æ‹¶ã¨è¢«ã‚‰ãªã„ã‚ˆã†å°‘ã—é…å»¶ï¼‰
      setTimeout(() => speak('ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼' + target.name + 'ã¯ã€ã©ã‚Œã‹ãªï¼Ÿ'), 800);
    }

    const correctMessages = [
      'ãŠã¨ã‹ã¡ã‚ƒã‚“ã€ã™ã”ãƒ¼ã„ï¼ã›ã„ã‹ã„ï¼',
      'ãŠã¨ã‹ã¡ã‚ƒã‚“ã€ã¦ã‚“ã•ã„ï¼',
      'ã‚„ã£ãŸã­ï¼ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼ã›ã„ã‹ã„ã ã‚ˆï¼',
      'ãŠã¨ã‹ã¡ã‚ƒã‚“ã€ã‹ã£ã“ã„ã„ï¼ã›ã„ã‹ã„ï¼',
    ];

    const wrongMessages = [
      'ãŠã—ã„ï¼ã‚‚ã†ã„ã£ã‹ã„ï¼',
      'ã‚‚ã†ã„ã¡ã©ã€ã‚„ã£ã¦ã¿ã‚ˆã†ï¼ãŒã‚“ã°ã‚Œï¼',
      'ã¡ãŒã†ã‚ˆãƒ¼ï¼ã‚‚ã†ã„ã£ã‹ã„ï¼',
    ];

    function checkColor(c, e) {
      const resultEl = document.getElementById('colorResult');
      if (c.name === colorAnswer.name) {
        colorStreak++;
        resultEl.textContent = 'â­ ã™ã”ã„ï¼ã›ã„ã‹ã„ï¼ â­';
        spawnStars(e.clientX || e.touches?.[0]?.clientX || 200, e.clientY || e.touches?.[0]?.clientY || 300, 6);

        const msg = correctMessages[Math.floor(Math.random() * correctMessages.length)];
        speak(msg);

        setTimeout(nextColorQuestion, 2500);
      } else {
        resultEl.textContent = 'ã‚‚ã†ã„ã£ã‹ã„ï¼ğŸ’ª';
        const msg = wrongMessages[Math.floor(Math.random() * wrongMessages.length)];
        speak(msg);
      }
      document.getElementById('colorScore').textContent = 'â­'.repeat(Math.min(colorStreak, 20));
    }

    /* ===== ãµã†ã›ã‚“ã‚²ãƒ¼ãƒ  ===== */
    const balloonEmojis = ['ğŸˆ', 'ğŸ©·', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ§¡', 'â­', 'ğŸŒŸ', 'ğŸ€'];
    let balloonScoreVal = 0;

    function startBalloons() {
      balloonScoreVal = 0;
      document.getElementById('balloonScore').textContent = '0';
      // æ—¢å­˜ã®é¢¨èˆ¹ã‚’æ¶ˆã™
      document.querySelectorAll('.balloon').forEach(b => b.remove());
      balloonInterval = setInterval(spawnBalloon, 900);
    }

    function stopBalloons() {
      if (balloonInterval) { clearInterval(balloonInterval); balloonInterval = null; }
    }

    function spawnBalloon() {
      const balloon = document.createElement('div');
      balloon.className = 'balloon';
      balloon.textContent = balloonEmojis[Math.floor(Math.random() * balloonEmojis.length)];

      const x = 10 + Math.random() * 80;
      balloon.style.left = x + '%';
      balloon.style.bottom = '-60px';

      const dur = 4 + Math.random() * 3;
      balloon.style.animationDuration = dur + 's';

      balloon.onclick = (e) => popBalloon(balloon, e);
      balloon.ontouchstart = (e) => {
        e.preventDefault();
        const t = e.touches[0];
        popBalloon(balloon, { clientX: t.clientX, clientY: t.clientY });
      };

      document.getElementById('balloons').appendChild(balloon);

      // ç”»é¢å¤–ã«å‡ºãŸã‚‰æ¶ˆã™
      setTimeout(() => { if (balloon.parentNode) balloon.remove(); }, dur * 1000 + 100);
    }

    function popBalloon(balloon, e) {
      if (!balloon.parentNode) return;
      const x = e.clientX || 200;
      const y = e.clientY || 300;

      // ãƒãƒƒãƒ—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      const pop = document.createElement('div');
      pop.className = 'pop-effect';
      pop.textContent = 'âœ¨';
      pop.style.left = (x - 16) + 'px';
      pop.style.top = (y - 16) + 'px';
      document.body.appendChild(pop);
      setTimeout(() => pop.remove(), 600);

      spawnStars(x, y, 4);
      balloon.remove();

      balloonScoreVal++;
      document.getElementById('balloonScore').textContent = balloonScoreVal;

      // ç¯€ç›®ã§è¤’ã‚ã‚‹
      const balloonPraise = {
        5:  'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼5ã“ã‚‚ã€ã‚ã£ãŸã­ï¼ã™ã”ã„ï¼',
        10: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼10ã“ï¼ã¨ã£ã¦ã‚‚ã€ã˜ã‚‡ã†ãšï¼',
        20: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼20ã“ï¼ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã ã­ï¼',
        30: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼30ã“ï¼ã ã‚Œã«ã‚‚ã€ã¾ã‘ãªã„ã­ï¼',
        50: 'ãŠã¨ã‹ã¡ã‚ƒã‚“ï¼50ã“ï¼ã™ã”ã™ãã‚‹ãƒ¼ï¼',
      };
      if (balloonPraise[balloonScoreVal]) {
        speak(balloonPraise[balloonScoreVal]);
      }
    }

    /* ===== ãŠãˆã‹ã ===== */
    const drawColors = ['#333', '#ff4757', '#ff9f43', '#ffd32a', '#2ed573', '#3498ff', '#a55eea', '#ff6b9d'];
    let drawColor = '#ff6b9d';
    let isDrawing = false;
    let drawCtx = null;

    function initCanvas() {
      const canvas = document.getElementById('drawCanvas');
      const toolbar = document.getElementById('drawToolbar');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - 70;
      drawCtx = canvas.getContext('2d');
      drawCtx.lineCap = 'round';
      drawCtx.lineJoin = 'round';
      drawCtx.lineWidth = 8;

      // ã‚«ãƒ©ãƒ¼ãƒœã‚¿ãƒ³
      toolbar.innerHTML = '';
      drawColors.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'draw-color' + (c === drawColor ? ' active' : '');
        btn.style.background = c;
        btn.onclick = () => {
          drawColor = c;
          toolbar.querySelectorAll('.draw-color').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        };
        toolbar.appendChild(btn);
      });

      const clearBtn = document.createElement('button');
      clearBtn.className = 'draw-clear';
      clearBtn.textContent = 'ã‘ã™';
      clearBtn.onclick = () => {
        drawCtx.clearRect(0, 0, canvas.width, canvas.height);
      };
      toolbar.appendChild(clearBtn);

      // æç”»ã‚¤ãƒ™ãƒ³ãƒˆ
      canvas.onmousedown = (e) => { isDrawing = true; drawCtx.beginPath(); drawCtx.moveTo(e.offsetX, e.offsetY); };
      canvas.onmousemove = (e) => { if (!isDrawing) return; drawCtx.strokeStyle = drawColor; drawCtx.lineTo(e.offsetX, e.offsetY); drawCtx.stroke(); };
      canvas.onmouseup = () => { isDrawing = false; };

      canvas.ontouchstart = (e) => {
        e.preventDefault();
        isDrawing = true;
        const t = e.touches[0];
        const r = canvas.getBoundingClientRect();
        drawCtx.beginPath();
        drawCtx.moveTo(t.clientX - r.left, t.clientY - r.top);
      };
      canvas.ontouchmove = (e) => {
        e.preventDefault();
        if (!isDrawing) return;
        const t = e.touches[0];
        const r = canvas.getBoundingClientRect();
        drawCtx.strokeStyle = drawColor;
        drawCtx.lineTo(t.clientX - r.left, t.clientY - r.top);
        drawCtx.stroke();
      };
      canvas.ontouchend = () => { isDrawing = false; };
    }

    /* ===== èµ·å‹•æ™‚ã®ã‚ã„ã•ã¤ ===== */
    window.addEventListener('load', () => {
      setTimeout(() => speak('ãŠã¨ã‹ã¡ã‚ƒã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ãã‚‡ã†ã¯ã€ãªã«ã—ã¦ã€ã‚ãã¶ï¼Ÿ'), 500);
    });

    /* ===== æ˜Ÿã‚¨ãƒ•ã‚§ã‚¯ãƒˆ ===== */
    function spawnStars(x, y, count) {
      const stars = ['â­', 'ğŸŒŸ', 'âœ¨', 'ğŸ’«'];
      for (let i = 0; i < count; i++) {
        const star = document.createElement('div');
        star.className = 'star-burst';
        star.textContent = stars[Math.floor(Math.random() * stars.length)];
        star.style.left = (x + (Math.random() - 0.5) * 80) + 'px';
        star.style.top = (y + (Math.random() - 0.5) * 80) + 'px';
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 800);
      }
    }
  </script>
</body>
</html>
