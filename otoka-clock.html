<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>„Åä„Å®„Åã„Å°„ÇÉ„Çì„ÅÆ „Å®„Åë„ÅÑ„Ç¢„Éó„É™</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    body {
      font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      overflow: hidden;
    }

    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 16px;
      opacity: 0;
      transition: opacity 0.4s;
    }
    .screen.active {
      display: flex;
      animation: fadeSlideIn 0.5s forwards;
    }

    @keyframes fadeSlideIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* ===== „Éõ„Éº„É† ===== */
    #home {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      position: relative;
      overflow: hidden;
    }

    .floating-emoji {
      position: absolute;
      font-size: 2rem;
      opacity: 0.3;
      animation: floatAround 8s infinite ease-in-out;
      pointer-events: none;
    }

    @keyframes floatAround {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-30px) rotate(10deg); }
      50% { transform: translateY(-10px) rotate(-5deg); }
      75% { transform: translateY(-40px) rotate(8deg); }
    }

    .home-mascot {
      font-size: 4rem;
      animation: mascotBounce 2s infinite;
      cursor: pointer;
      transition: transform 0.2s;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
    }
    .home-mascot:active { transform: scale(1.3) rotate(15deg); }

    @keyframes mascotBounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-15px) rotate(-5deg); }
      50% { transform: translateY(0) rotate(0deg); }
      75% { transform: translateY(-8px) rotate(5deg); }
    }

    .home-title {
      font-size: 1.4rem;
      color: #e44d7b;
      margin-bottom: 2px;
    }

    .home-name {
      font-size: 2.2rem;
      color: #ff6b9d;
      margin-bottom: 8px;
      text-shadow: 2px 2px 4px rgba(255,107,157,0.3);
    }

    .stamp-counter {
      background: rgba(255,255,255,0.8);
      border-radius: 20px;
      padding: 6px 16px;
      font-size: 0.95rem;
      color: #e44d7b;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
    }

    .menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      max-width: 340px;
      width: 100%;
    }

    .menu-btn {
      background: #fff;
      border: none;
      border-radius: 22px;
      padding: 16px 8px;
      cursor: pointer;
      box-shadow: 0 5px 18px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      position: relative;
      overflow: hidden;
    }
    .menu-btn:active { transform: scale(0.92); box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .menu-btn .icon { font-size: 2.6rem; transition: transform 0.3s; }
    .menu-btn:hover .icon { transform: scale(1.1) rotate(5deg); }
    .menu-btn .label { color: #555; font-weight: 600; font-size: 0.85rem; line-height: 1.3; }
    .menu-btn .badge {
      position: absolute;
      top: 6px;
      right: 6px;
      background: #ff6b9d;
      color: #fff;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    /* Êàª„Çã„Éú„Çø„É≥ */
    .back-btn {
      position: fixed;
      top: 14px;
      left: 14px;
      z-index: 100;
      background: rgba(255,255,255,0.92);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 2px 12px rgba(0,0,0,0.12);
      display: none;
      transition: transform 0.2s;
    }
    .back-btn.show { display: flex; align-items: center; justify-content: center; }
    .back-btn:active { transform: scale(0.9); }

    /* ===== ÊôÇË®àÂÖ±ÈÄö ===== */
    .clock-container {
      position: relative;
      width: 280px;
      height: 280px;
      margin: 0 auto;
    }

    .clock-face {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 6px 30px rgba(0,0,0,0.12);
      position: relative;
      border: 5px solid #f0e6ff;
    }

    .clock-number {
      position: absolute;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 700;
      color: #444;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .clock-number:active { transform: scale(1.2); }
    .clock-number.highlight {
      background: #ff6b9d;
      color: #fff;
      transform: scale(1.3);
      box-shadow: 0 4px 16px rgba(255,107,157,0.4);
    }
    .clock-number.correct {
      background: #2ed573;
      color: #fff;
      transform: scale(1.4);
      animation: popBig 0.5s;
    }
    .clock-number.wrong {
      background: #ff6b6b;
      color: #fff;
      animation: shake 0.4s;
    }
    .clock-number.color-hint {
      border: 3px solid currentColor;
    }

    @keyframes popBig {
      0% { transform: scale(1.3); }
      40% { transform: scale(1.8); }
      100% { transform: scale(1.4); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px) rotate(-5deg); }
      40% { transform: translateX(8px) rotate(5deg); }
      60% { transform: translateX(-6px) rotate(-3deg); }
      80% { transform: translateX(6px) rotate(3deg); }
    }

    .clock-center {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 12px;
      height: 12px;
      background: #e44d7b;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    .clock-hand {
      position: absolute;
      bottom: 50%;
      left: 50%;
      transform-origin: bottom center;
      border-radius: 4px;
      transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .hand-hour {
      width: 7px;
      height: 65px;
      background: #e44d7b;
      margin-left: -3.5px;
      z-index: 5;
    }

    .hand-minute {
      width: 4px;
      height: 95px;
      background: #7c5cbf;
      margin-left: -2px;
      z-index: 6;
    }

    /* ===== „Åô„ÅÜ„Åò„Çí„Åä„Åº„Åà„Çà„ÅÜ ===== */
    #learn {
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    }

    .learn-title {
      font-size: 1.2rem;
      color: #4caf50;
      margin-bottom: 12px;
    }

    .learn-display {
      margin-top: 16px;
      text-align: center;
      min-height: 90px;
    }

    .learn-big-number {
      font-size: 4.5rem;
      font-weight: 800;
      color: #ff6b9d;
    }

    .learn-big-number.animate {
      animation: numberPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes numberPop {
      0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
      60% { transform: scale(1.2) rotate(3deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .learn-label {
      font-size: 1.2rem;
      color: #888;
      margin-top: 2px;
    }

    .learn-finger-emoji {
      font-size: 2.5rem;
      margin-top: 4px;
      min-height: 3rem;
    }

    /* ===== „Åô„ÅÜ„Åò„ÇØ„Ç§„Ç∫ ===== */
    #quiz {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    }

    .quiz-question {
      font-size: 1.5rem;
      color: #1976d2;
      margin-bottom: 12px;
      font-weight: 700;
      min-height: 2em;
    }

    .quiz-question .target-num {
      font-size: 2.4rem;
      color: #e44d7b;
      display: inline-block;
      animation: targetPulse 1s infinite;
    }

    @keyframes targetPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .quiz-result {
      margin-top: 12px;
      font-size: 1.8rem;
      min-height: 2.2rem;
    }

    .quiz-score {
      margin-top: 6px;
      font-size: 1.1rem;
      color: #1976d2;
    }

    /* ===== „ÅÑ„Åæ„Å™„Çì„Åò ===== */
    #time {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    }

    .time-title {
      font-size: 1.2rem;
      color: #e65100;
      margin-bottom: 12px;
    }

    .time-display {
      margin-top: 16px;
      font-size: 2.8rem;
      font-weight: 700;
      color: #e65100;
    }

    .time-label {
      margin-top: 4px;
      font-size: 0.95rem;
      color: #999;
    }

    .time-greeting {
      margin-top: 8px;
      font-size: 1.3rem;
      color: #bf360c;
    }

    /* ===== „Å®„Åë„ÅÑ„ÇØ„Ç§„Ç∫ ===== */
    #clockquiz {
      background: linear-gradient(135deg, #f3e5f5, #e1bee7);
    }

    .clockquiz-question {
      font-size: 1.3rem;
      color: #7b1fa2;
      margin-bottom: 12px;
      font-weight: 700;
    }

    .clockquiz-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
      max-width: 300px;
      width: 100%;
    }

    .clockquiz-opt {
      background: #fff;
      border: 3px solid #e1bee7;
      border-radius: 18px;
      padding: 14px;
      font-size: 1.5rem;
      font-weight: 700;
      color: #7b1fa2;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .clockquiz-opt:active { transform: scale(0.93); }
    .clockquiz-opt.correct {
      background: #c8e6c9;
      border-color: #4caf50;
      color: #2e7d32;
      transform: scale(1.1);
    }
    .clockquiz-opt.wrong {
      background: #ffcdd2;
      border-color: #e53935;
      color: #c62828;
      animation: shake 0.4s;
    }

    .clockquiz-result {
      margin-top: 10px;
      font-size: 1.8rem;
      min-height: 2.2rem;
    }

    .clockquiz-score {
      margin-top: 4px;
      font-size: 1.1rem;
      color: #7b1fa2;
    }

    /* ===== „ÅÑ„Çç„ÅÇ„Å¶„ÇØ„Ç§„Ç∫ ===== */
    #colorquiz {
      background: linear-gradient(135deg, #fce4ec, #f8bbd0);
    }

    .colorquiz-question {
      font-size: 1.3rem;
      color: #c2185b;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .color-target {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 0 auto 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      animation: colorPulse 1.5s infinite;
    }

    @keyframes colorPulse {
      0%, 100% { transform: scale(1); box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
      50% { transform: scale(1.05); box-shadow: 0 6px 24px rgba(0,0,0,0.2); }
    }

    .color-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      max-width: 280px;
      width: 100%;
    }

    .color-opt {
      background: #fff;
      border: 3px solid #f8bbd0;
      border-radius: 16px;
      padding: 14px;
      font-size: 1.3rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .color-opt:active { transform: scale(0.93); }
    .color-opt.correct {
      background: #c8e6c9;
      border-color: #4caf50;
      transform: scale(1.1);
    }
    .color-opt.wrong {
      background: #ffcdd2;
      border-color: #e53935;
      animation: shake 0.4s;
    }

    .colorquiz-result {
      margin-top: 10px;
      font-size: 1.8rem;
      min-height: 2.2rem;
    }

    .colorquiz-score {
      font-size: 1.1rem;
      color: #c2185b;
    }

    /* ===== „Åò„ÇÖ„Çì„Å∞„Çì„Å™„Çâ„Åπ ===== */
    #order {
      background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
    }

    .order-title {
      font-size: 1.2rem;
      color: #00838f;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .order-slots {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 14px;
      min-height: 56px;
    }

    .order-slot {
      width: 48px;
      height: 48px;
      border: 3px dashed #b2ebf2;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 700;
      color: #00838f;
      background: rgba(255,255,255,0.6);
      transition: all 0.3s;
    }
    .order-slot.filled {
      background: #fff;
      border: 3px solid #00bcd4;
      animation: slotFill 0.3s;
    }
    .order-slot.wrong-slot {
      border-color: #e53935;
      animation: shake 0.4s;
    }

    @keyframes slotFill {
      0% { transform: scale(0.5); }
      60% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .order-choices {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 340px;
    }

    .order-choice {
      width: 52px;
      height: 52px;
      background: #fff;
      border: 3px solid #80deea;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      font-weight: 700;
      color: #00838f;
      cursor: pointer;
      transition: all 0.2s;
    }
    .order-choice:active { transform: scale(0.9); }
    .order-choice.used {
      opacity: 0.3;
      pointer-events: none;
      transform: scale(0.8);
    }

    .order-result {
      margin-top: 10px;
      font-size: 1.8rem;
      min-height: 2.2rem;
    }

    .order-score {
      font-size: 1.1rem;
      color: #00838f;
    }

    /* ===== „Çπ„Çø„É≥„Éó„Ç´„Éº„Éâ ===== */
    #stamps {
      background: linear-gradient(135deg, #fff8e1, #ffecb3);
    }

    .stamps-title {
      font-size: 1.3rem;
      color: #f57f17;
      margin-bottom: 12px;
      font-weight: 700;
    }

    .stamp-card {
      background: #fff;
      border-radius: 20px;
      padding: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 320px;
      width: 100%;
    }

    .stamp-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
    }

    .stamp-cell {
      aspect-ratio: 1;
      border-radius: 14px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      border: 2px dashed #e0e0e0;
      transition: all 0.3s;
    }
    .stamp-cell.earned {
      background: #fff9c4;
      border: 2px solid #ffd54f;
      animation: stampAppear 0.5s;
    }

    @keyframes stampAppear {
      0% { transform: scale(0) rotate(-180deg); }
      60% { transform: scale(1.3) rotate(10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    .stamp-progress {
      text-align: center;
      margin-top: 12px;
      font-size: 1rem;
      color: #f57f17;
    }

    .stamp-progress-bar {
      height: 10px;
      background: #f5f5f5;
      border-radius: 5px;
      margin-top: 6px;
      overflow: hidden;
    }

    .stamp-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ffd54f, #ff9800);
      border-radius: 5px;
      transition: width 0.5s;
    }

    .stamp-reward {
      text-align: center;
      margin-top: 12px;
      font-size: 1.1rem;
      color: #e65100;
      min-height: 1.4rem;
    }

    /* ===== Á¥ôÂêπÈõ™ ===== */
    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 500;
      font-size: 1.2rem;
      animation: confettiFall 1.5s forwards;
    }

    @keyframes confettiFall {
      0% { transform: translateY(-20px) rotate(0deg) scale(1); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg) scale(0.3); opacity: 0; }
    }

    /* Êòü„Ç®„Éï„Çß„ÇØ„Éà */
    .star-burst {
      position: fixed;
      pointer-events: none;
      z-index: 300;
      font-size: 1.8rem;
      animation: starPop 0.9s forwards;
    }

    @keyframes starPop {
      0% { transform: scale(0) rotate(0deg); opacity: 1; }
      40% { transform: scale(1.8) rotate(180deg); opacity: 1; }
      100% { transform: scale(0.3) rotate(360deg) translateY(-80px); opacity: 0; }
    }

    /* „É™„ÉÉ„Éó„É´ */
    .ripple {
      position: fixed;
      pointer-events: none;
      z-index: 200;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #ff6b9d;
      animation: rippleOut 0.6s forwards;
    }

    @keyframes rippleOut {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
    }

    /* Èü≥„Éú„Çø„É≥ */
    .sound-toggle {
      position: fixed;
      top: 14px;
      right: 14px;
      z-index: 100;
      background: rgba(255,255,255,0.92);
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 1.3rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.12);
    }
  </style>
</head>
<body>

  <button class="back-btn" id="backBtn" onclick="goHome()">üè†</button>
  <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</button>

  <!-- „Éõ„Éº„É† -->
  <div class="screen active" id="home">
    <div class="floating-emoji" style="top:10%;left:10%;animation-delay:0s">üåü</div>
    <div class="floating-emoji" style="top:20%;right:15%;animation-delay:2s">üéµ</div>
    <div class="floating-emoji" style="bottom:25%;left:8%;animation-delay:4s">ü¶ã</div>
    <div class="floating-emoji" style="bottom:15%;right:12%;animation-delay:6s">üåà</div>

    <div class="home-mascot" onclick="playSound('pop');this.style.animation='none';this.offsetHeight;this.style.animation='mascotBounce 2s infinite';">üê±</div>
    <div class="home-title">„Çà„ÅÜ„Åì„ÅùÔºÅ</div>
    <div class="home-name">„Åä„Å®„Åã„Å°„ÇÉ„Çì„ÅÆ „Å®„Åë„ÅÑ</div>
    <div class="stamp-counter" id="stampCounter" onclick="goScreen('stamps')">üèÜ „Çπ„Çø„É≥„Éó: 0„Åì</div>
    <div class="menu">
      <button class="menu-btn" onclick="goScreen('learn')">
        <span class="icon">üî¢</span>
        <span class="label">„Åô„ÅÜ„Åò„Çí<br>„Åä„Åº„Åà„Çà„ÅÜ</span>
      </button>
      <button class="menu-btn" onclick="goScreen('quiz')">
        <span class="icon">‚ùì</span>
        <span class="label">„Åô„ÅÜ„Åò<br>„ÇØ„Ç§„Ç∫</span>
      </button>
      <button class="menu-btn" onclick="goScreen('time')">
        <span class="icon">üïê</span>
        <span class="label">„ÅÑ„Åæ<br>„Å™„Çì„ÅòÔºü</span>
      </button>
      <button class="menu-btn" onclick="goScreen('clockquiz')">
        <span class="icon">üéØ</span>
        <span class="label">„Å®„Åë„ÅÑ<br>„ÇØ„Ç§„Ç∫</span>
      </button>
      <button class="menu-btn" onclick="goScreen('colorquiz')">
        <span class="icon">üé®</span>
        <span class="label">„ÅÑ„Çç„ÅÇ„Å¶<br>„ÇØ„Ç§„Ç∫</span>
        <span class="badge">New</span>
      </button>
      <button class="menu-btn" onclick="goScreen('order')">
        <span class="icon">üî§</span>
        <span class="label">„Åò„ÇÖ„Çì„Å∞„Çì<br>„Å™„Çâ„Åπ</span>
        <span class="badge">New</span>
      </button>
    </div>
  </div>

  <!-- „Åô„ÅÜ„Åò„Çí„Åä„Åº„Åà„Çà„ÅÜ -->
  <div class="screen" id="learn">
    <div class="learn-title">„Åô„ÅÜ„Åò„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Å≠ÔºÅ</div>
    <div class="clock-container">
      <div class="clock-face" id="learnClock"></div>
    </div>
    <div class="learn-display">
      <div class="learn-big-number" id="learnNumber"></div>
      <div class="learn-label" id="learnLabel"></div>
      <div class="learn-finger-emoji" id="learnFingers"></div>
    </div>
  </div>

  <!-- „Åô„ÅÜ„Åò„ÇØ„Ç§„Ç∫ -->
  <div class="screen" id="quiz">
    <div class="quiz-question" id="quizQuestion"></div>
    <div class="clock-container">
      <div class="clock-face" id="quizClock"></div>
    </div>
    <div class="quiz-result" id="quizResult"></div>
    <div class="quiz-score" id="quizScore"></div>
  </div>

  <!-- „ÅÑ„Åæ„Å™„Çì„Åò -->
  <div class="screen" id="time">
    <div class="time-title">„ÅÑ„Åæ„ÅÆ„Åò„Åã„Çì„Å†„ÇàÔºÅ</div>
    <div class="clock-container">
      <div class="clock-face" id="timeClock">
        <div class="clock-hand hand-hour" id="timeHourHand"></div>
        <div class="clock-hand hand-minute" id="timeMinuteHand"></div>
        <div class="clock-center"></div>
      </div>
    </div>
    <div class="time-display" id="timeDisplay"></div>
    <div class="time-greeting" id="timeGreeting"></div>
    <div class="time-label">„Åò„Åã„Çì„ÅØ „Å©„Çì„Å©„Çì „Åô„Åô„ÇÄ„ÇàÔºÅ</div>
  </div>

  <!-- „Å®„Åë„ÅÑ„ÇØ„Ç§„Ç∫ -->
  <div class="screen" id="clockquiz">
    <div class="clockquiz-question" id="clockquizQ">„Åì„ÅÆ„Å®„Åë„ÅÑ„ÄÅ„Å™„Çì„ÅòÔºü</div>
    <div class="clock-container">
      <div class="clock-face" id="clockquizClock">
        <div class="clock-hand hand-hour" id="cqHourHand"></div>
        <div class="clock-hand hand-minute" id="cqMinuteHand"></div>
        <div class="clock-center"></div>
      </div>
    </div>
    <div class="clockquiz-options" id="clockquizOpts"></div>
    <div class="clockquiz-result" id="clockquizResult"></div>
    <div class="clockquiz-score" id="clockquizScore"></div>
  </div>

  <!-- „ÅÑ„Çç„ÅÇ„Å¶„ÇØ„Ç§„Ç∫ -->
  <div class="screen" id="colorquiz">
    <div class="colorquiz-question" id="colorquizQ">„Åì„ÅÆ„ÅÑ„Çç„ÄÅ„Å™„Éº„Çì„Å†Ôºü</div>
    <div class="color-target" id="colorTarget"></div>
    <div class="color-options" id="colorOpts"></div>
    <div class="colorquiz-result" id="colorquizResult"></div>
    <div class="colorquiz-score" id="colorquizScore"></div>
  </div>

  <!-- „Åò„ÇÖ„Çì„Å∞„Çì„Å™„Çâ„Åπ -->
  <div class="screen" id="order">
    <div class="order-title" id="orderTitle">„Å°„ÅÑ„Åï„ÅÑ„Åò„ÇÖ„Çì„Å´ „Å™„Çâ„Åπ„Å¶„Å≠ÔºÅ</div>
    <div class="order-slots" id="orderSlots"></div>
    <div class="order-choices" id="orderChoices"></div>
    <div class="order-result" id="orderResult"></div>
    <div class="order-score" id="orderScore"></div>
  </div>

  <!-- „Çπ„Çø„É≥„Éó„Ç´„Éº„Éâ -->
  <div class="screen" id="stamps">
    <div class="stamps-title">üèÜ „Çπ„Çø„É≥„Éó„Ç´„Éº„Éâ üèÜ</div>
    <div class="stamp-card">
      <div class="stamp-grid" id="stampGrid"></div>
      <div class="stamp-progress">
        <span id="stampProgressText">0 / 20</span>
        <div class="stamp-progress-bar">
          <div class="stamp-progress-fill" id="stampProgressFill" style="width:0%"></div>
        </div>
      </div>
    </div>
    <div class="stamp-reward" id="stampReward"></div>
  </div>

  <script>
    /* ===== „Çµ„Ç¶„É≥„Éâ„Ç∑„Çπ„ÉÜ„É† (Web Audio API) ===== */
    let audioCtx = null;
    let soundEnabled = true;

    function getAudioCtx() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      return audioCtx;
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
    }

    function playSound(type) {
      if (!soundEnabled) return;
      try {
        const ctx = getAudioCtx();
        if (ctx.state === 'suspended') ctx.resume();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);

        const now = ctx.currentTime;

        switch (type) {
          case 'tap':
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, now);
            osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            osc.start(now);
            osc.stop(now + 0.15);
            break;

          case 'correct':
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523, now);
            osc.frequency.setValueAtTime(659, now + 0.1);
            osc.frequency.setValueAtTime(784, now + 0.2);
            osc.frequency.setValueAtTime(1047, now + 0.3);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
            osc.start(now);
            osc.stop(now + 0.5);
            break;

          case 'wrong':
            osc.type = 'square';
            osc.frequency.setValueAtTime(200, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.3);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
            break;

          case 'pop':
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, now);
            osc.frequency.exponentialRampToValueAtTime(400, now + 0.08);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);
            osc.start(now);
            osc.stop(now + 0.12);
            break;

          case 'stamp':
            osc.type = 'sine';
            osc.frequency.setValueAtTime(440, now);
            osc.frequency.setValueAtTime(554, now + 0.08);
            osc.frequency.setValueAtTime(659, now + 0.16);
            osc.frequency.setValueAtTime(880, now + 0.24);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.setValueAtTime(0.2, now + 0.3);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
            osc.start(now);
            osc.stop(now + 0.6);
            break;

          case 'complete':
            // ÂÆåÊàê„Éï„Ç°„É≥„Éï„Ç°„Éº„É¨
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523, now);
            osc.frequency.setValueAtTime(659, now + 0.15);
            osc.frequency.setValueAtTime(784, now + 0.3);
            osc.frequency.setValueAtTime(1047, now + 0.45);
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.setValueAtTime(0.25, now + 0.5);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.8);
            osc.start(now);
            osc.stop(now + 0.8);
            break;

          case 'number':
            // Êï∞Â≠ó„Çø„ÉÉ„ÉóÊôÇ„ÅÆ„Åã„Çè„ÅÑ„ÅÑÈü≥
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(600 + Math.random() * 400, now);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now);
            osc.stop(now + 0.2);
            break;
        }
      } catch (e) {}
    }

    // Êï∞Â≠ó„Å´ÂØæÂøú„Åó„ÅüÈü≥Èöé
    function playNumberTone(num) {
      if (!soundEnabled) return;
      try {
        const ctx = getAudioCtx();
        if (ctx.state === 'suspended') ctx.resume();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        const now = ctx.currentTime;

        // „Éâ„É¨„Éü„Éï„Ç°„ÇΩ„É©„Ç∑„Éâ„É¨„Éü„Éï„Ç°„Ç∑
        const freqs = [262, 294, 330, 349, 392, 440, 494, 523, 587, 659, 698, 784];
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freqs[num - 1], now);
        gain.gain.setValueAtTime(0.2, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
        osc.start(now);
        osc.stop(now + 0.4);
      } catch (e) {}
    }

    /* ===== „Ç®„Éï„Çß„ÇØ„Éà ===== */
    function spawnRipple(x, y) {
      const el = document.createElement('div');
      el.className = 'ripple';
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 600);
    }

    function spawnStars(el) {
      const rect = el.getBoundingClientRect();
      spawnStarsAt(rect.left + rect.width / 2, rect.top + rect.height / 2);
    }

    function spawnStarsAt(cx, cy) {
      const stars = ['‚≠ê', 'üåü', '‚ú®', 'üí´', 'üéâ'];
      for (let i = 0; i < 8; i++) {
        const star = document.createElement('div');
        star.className = 'star-burst';
        star.textContent = stars[Math.floor(Math.random() * stars.length)];
        star.style.left = (cx + (Math.random() - 0.5) * 140) + 'px';
        star.style.top = (cy + (Math.random() - 0.5) * 140) + 'px';
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 900);
      }
    }

    function spawnConfetti() {
      const emojis = ['üéä', 'üéâ', '‚≠ê', 'üåà', 'üéµ', 'üíñ', 'ü¶ã', 'üå∏'];
      for (let i = 0; i < 20; i++) {
        setTimeout(() => {
          const el = document.createElement('div');
          el.className = 'confetti';
          el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          el.style.left = (Math.random() * 100) + 'vw';
          el.style.top = '-20px';
          el.style.animationDuration = (1 + Math.random() * 1.5) + 's';
          document.body.appendChild(el);
          setTimeout(() => el.remove(), 2500);
        }, i * 80);
      }
    }

    // „Çø„ÉÉ„ÉóÊôÇ„ÅÆ„É™„ÉÉ„Éó„É´
    document.addEventListener('touchstart', (e) => {
      if (e.touches[0]) spawnRipple(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: true });
    document.addEventListener('mousedown', (e) => {
      spawnRipple(e.clientX, e.clientY);
    });

    /* ===== „Çπ„Çø„É≥„Éó„Ç∑„Çπ„ÉÜ„É† ===== */
    const STAMP_EMOJIS = ['üåü', 'üéµ', 'ü¶ã', 'üåà', 'üê±', 'üå∏', 'üéÄ', 'üçì', 'üê∞', 'üåª',
                          'üíé', 'üé™', 'ü¶Ñ', 'üç≠', 'üê£', 'üé†', 'üß∏', 'üéà', 'üç∞', 'üëë'];
    let totalStamps = 0;
    let earnedStamps = []; // true/false array

    function loadStamps() {
      try {
        const saved = localStorage.getItem('otoka_stamps');
        if (saved) {
          const data = JSON.parse(saved);
          totalStamps = data.total || 0;
          earnedStamps = data.earned || [];
        }
      } catch (e) {}
      while (earnedStamps.length < 20) earnedStamps.push(false);
      updateStampDisplay();
    }

    function saveStamps() {
      try {
        localStorage.setItem('otoka_stamps', JSON.stringify({ total: totalStamps, earned: earnedStamps }));
      } catch (e) {}
    }

    function addStamp() {
      // Ê¨°„ÅÆÁ©∫„Åç„Çπ„É≠„ÉÉ„Éà„Å´„Çπ„Çø„É≥„Éó
      const idx = earnedStamps.indexOf(false);
      if (idx !== -1) {
        earnedStamps[idx] = true;
        totalStamps++;
        saveStamps();
        updateStampDisplay();
        playSound('stamp');

        if (totalStamps % 20 === 0) {
          // 20ÂÄã„Åî„Å®„Å´„É™„Çª„ÉÉ„ÉàÔºÜ„ÅäÁ•ù„ÅÑ
          setTimeout(() => {
            spawnConfetti();
            playSound('complete');
          }, 500);
          setTimeout(() => {
            earnedStamps = new Array(20).fill(false);
            saveStamps();
            updateStampDisplay();
          }, 3000);
        }
      }
    }

    function updateStampDisplay() {
      document.getElementById('stampCounter').textContent = `üèÜ „Çπ„Çø„É≥„Éó: ${totalStamps}„Åì`;

      const grid = document.getElementById('stampGrid');
      if (grid) {
        grid.innerHTML = '';
        for (let i = 0; i < 20; i++) {
          const cell = document.createElement('div');
          cell.className = 'stamp-cell' + (earnedStamps[i] ? ' earned' : '');
          cell.textContent = earnedStamps[i] ? STAMP_EMOJIS[i] : '';
          grid.appendChild(cell);
        }
      }

      const count = earnedStamps.filter(Boolean).length;
      const text = document.getElementById('stampProgressText');
      const fill = document.getElementById('stampProgressFill');
      const reward = document.getElementById('stampReward');
      if (text) text.textContent = `${count} / 20`;
      if (fill) fill.style.width = (count / 20 * 100) + '%';
      if (reward) {
        if (count >= 20) {
          reward.textContent = 'üéâ „Åô„Åî„ÅÑÔºÅ„Åú„Çì„Å∂„ÅÇ„Å§„ÇÅ„ÅüÔºÅ üéâ';
        } else {
          reward.textContent = `„ÅÇ„Å® ${20 - count}„Åì„Åß „Ç≥„É≥„Éó„É™„Éº„ÉàÔºÅ`;
        }
      }
    }

    /* ===== ÊôÇË®à„ÅÆÊï∞Â≠ó„ÇíÈÖçÁΩÆ ===== */
    const numberNames = {
      1: '„ÅÑ„Å°', 2: '„Å´', 3: '„Åï„Çì', 4: '„Çà„Çì',
      5: '„Åî', 6: '„Çç„Åè', 7: '„Å™„Å™', 8: '„ÅØ„Å°',
      9: '„Åç„ÇÖ„ÅÜ', 10: '„Åò„ÇÖ„ÅÜ', 11: '„Åò„ÇÖ„ÅÜ„ÅÑ„Å°', 12: '„Åò„ÇÖ„ÅÜ„Å´'
    };

    function buildClockNumbers(clockEl, onClick) {
      for (let i = 1; i <= 12; i++) {
        const el = document.createElement('div');
        el.className = 'clock-number';
        el.textContent = i;
        el.dataset.num = i;

        const angle = (i * 30 - 90) * (Math.PI / 180);
        const r = 108;
        const cx = 140 - 21;
        const cy = 140 - 21;
        el.style.left = (cx + r * Math.cos(angle)) + 'px';
        el.style.top = (cy + r * Math.sin(angle)) + 'px';

        if (onClick) el.onclick = () => onClick(i, el);
        clockEl.appendChild(el);
      }
    }

    /* ===== ÁîªÈù¢Âàá„ÇäÊõø„Åà ===== */
    let timeInterval = null;

    function goScreen(name) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const screen = document.getElementById(name);
      screen.classList.add('active');
      document.getElementById('backBtn').classList.toggle('show', name !== 'home');

      if (timeInterval) { clearInterval(timeInterval); timeInterval = null; }

      playSound('pop');

      if (name === 'learn') initLearn();
      if (name === 'quiz') startQuiz();
      if (name === 'time') startRealClock();
      if (name === 'clockquiz') startClockQuiz();
      if (name === 'colorquiz') startColorQuiz();
      if (name === 'order') startOrder();
      if (name === 'stamps') updateStampDisplay();
      if (name === 'home') updateStampDisplay();
    }

    function goHome() { goScreen('home'); }

    /* ===== „Åô„ÅÜ„Åò„Çí„Åä„Åº„Åà„Çà„ÅÜ ===== */
    const fingerEmojis = {
      1: '‚òùÔ∏è', 2: '‚úåÔ∏è', 3: 'ü§ü', 4: 'üññ', 5: 'üñêÔ∏è',
      6: 'üñêÔ∏è‚òùÔ∏è', 7: 'üñêÔ∏è‚úåÔ∏è', 8: 'üñêÔ∏èü§ü', 9: 'üñêÔ∏èüññ', 10: 'üñêÔ∏èüñêÔ∏è',
      11: 'üñêÔ∏èüñêÔ∏è‚òùÔ∏è', 12: 'üñêÔ∏èüñêÔ∏è‚úåÔ∏è'
    };

    let learnInited = false;
    function initLearn() {
      if (learnInited) return;
      learnInited = true;
      const learnClock = document.getElementById('learnClock');
      buildClockNumbers(learnClock, (num, el) => {
        learnClock.querySelectorAll('.clock-number').forEach(n => n.classList.remove('highlight'));
        el.classList.add('highlight');

        playNumberTone(num);

        const bigNum = document.getElementById('learnNumber');
        bigNum.textContent = num;
        bigNum.className = 'learn-big-number';
        bigNum.offsetHeight;
        bigNum.className = 'learn-big-number animate';

        document.getElementById('learnLabel').textContent = `„Äå${numberNames[num]}„Äç`;
        document.getElementById('learnFingers').textContent = fingerEmojis[num] || '';
      });
    }

    /* ===== „Åô„ÅÜ„Åò„ÇØ„Ç§„Ç∫ ===== */
    let quizAnswer = null;
    let quizStreak = 0;
    let quizLocked = false;
    let quizInited = false;

    function startQuiz() {
      if (!quizInited) {
        quizInited = true;
        const quizClock = document.getElementById('quizClock');
        buildClockNumbers(quizClock, (num, el) => {
          if (quizLocked) return;

          if (num === quizAnswer) {
            quizLocked = true;
            quizStreak++;
            el.classList.add('correct');
            playSound('correct');
            document.getElementById('quizResult').textContent = '‚≠ê „Åõ„ÅÑ„Åã„ÅÑÔºÅ ‚≠ê';
            spawnStars(el);
            document.getElementById('quizScore').textContent = '‚≠ê'.repeat(Math.min(quizStreak, 20));

            if (quizStreak % 3 === 0) addStamp();

            setTimeout(() => {
              quizClock.querySelectorAll('.clock-number').forEach(n => {
                n.classList.remove('correct', 'wrong');
              });
              nextQuizQuestion();
            }, 1500);
          } else {
            el.classList.add('wrong');
            playSound('wrong');
            document.getElementById('quizResult').textContent = '„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑÔºÅüí™';
            setTimeout(() => el.classList.remove('wrong'), 400);
          }
        });
      }
      quizStreak = 0;
      document.getElementById('quizScore').textContent = '';
      nextQuizQuestion();
    }

    function nextQuizQuestion() {
      quizLocked = false;
      quizAnswer = Math.floor(Math.random() * 12) + 1;
      document.getElementById('quizQuestion').innerHTML =
        `<span class="target-num">${quizAnswer}</span> „ÅØ„Å©„Åì„Åã„Å™Ôºü`;
      document.getElementById('quizResult').textContent = '';
      document.getElementById('quizClock').querySelectorAll('.clock-number').forEach(n => {
        n.classList.remove('correct', 'wrong', 'highlight');
      });
    }

    /* ===== „ÅÑ„Åæ„Å™„Çì„Åò ===== */
    let timeInited = false;
    function startRealClock() {
      if (!timeInited) {
        timeInited = true;
        buildClockNumbers(document.getElementById('timeClock'), null);
      }
      updateRealClock();
      timeInterval = setInterval(updateRealClock, 1000);
    }

    function updateRealClock() {
      const now = new Date();
      const h = now.getHours() % 12;
      const m = now.getMinutes();

      const hourDeg = h * 30 + m * 0.5;
      const minDeg = m * 6;

      document.getElementById('timeHourHand').style.transform = `rotate(${hourDeg}deg)`;
      document.getElementById('timeMinuteHand').style.transform = `rotate(${minDeg}deg)`;

      const dispH = now.getHours();
      const dispM = String(m).padStart(2, '0');
      document.getElementById('timeDisplay').textContent = `${dispH}„Åò ${dispM}„Åµ„Çì`;

      // ÊôÇÈñìÂ∏Ø„ÅÆÊå®Êã∂
      const greeting = document.getElementById('timeGreeting');
      if (dispH < 6) greeting.textContent = 'üåô „Åæ„Å†„Çà„Çã„Å†„Å≠ „Åä„ÇÑ„Åô„Åø„Äú';
      else if (dispH < 10) greeting.textContent = 'üåÖ „Åä„ÅØ„Çà„ÅÜÔºÅ„ÅÇ„Åï„Å†„ÇàÔºÅ';
      else if (dispH < 12) greeting.textContent = '‚òÄÔ∏è „Åä„Å≤„Çã„Åæ„Åà„Å†„Å≠ÔºÅ';
      else if (dispH < 14) greeting.textContent = 'üçô „Åä„Å≤„Çã„Åî„ÅØ„Çì„ÅÆ„Åò„Åã„ÇìÔºÅ';
      else if (dispH < 17) greeting.textContent = 'üå§Ô∏è „Åî„Åî„Å†„ÇàÔºÅ„ÅÇ„Åù„Åº„ÅÜÔºÅ';
      else if (dispH < 19) greeting.textContent = 'üåá „ÇÜ„ÅÜ„Åå„Åü„Å†„Å≠';
      else greeting.textContent = 'üåô „Çà„Çã„Å†„Å≠ „Åä„ÇÑ„Åô„Åø„ÅÆ„Åò„Åã„Çì';

      const currentH = h === 0 ? 12 : h;
      document.getElementById('timeClock').querySelectorAll('.clock-number').forEach(n => {
        n.classList.toggle('highlight', parseInt(n.dataset.num) === currentH);
      });
    }

    /* ===== „Å®„Åë„ÅÑ„ÇØ„Ç§„Ç∫ ===== */
    let cqAnswer = null;
    let cqStreak = 0;
    let cqLocked = false;
    let cqInited = false;

    function startClockQuiz() {
      if (!cqInited) {
        cqInited = true;
        buildClockNumbers(document.getElementById('clockquizClock'), null);
      }
      cqStreak = 0;
      document.getElementById('clockquizScore').textContent = '';
      nextClockQuiz();
    }

    function nextClockQuiz() {
      cqLocked = false;
      cqAnswer = Math.floor(Math.random() * 12) + 1;

      const hourDeg = cqAnswer * 30;
      document.getElementById('cqHourHand').style.transform = `rotate(${hourDeg}deg)`;
      document.getElementById('cqMinuteHand').style.transform = `rotate(0deg)`;

      document.getElementById('clockquizClock').querySelectorAll('.clock-number').forEach(n => {
        n.classList.remove('highlight');
      });

      const options = new Set([cqAnswer]);
      while (options.size < 4) {
        options.add(Math.floor(Math.random() * 12) + 1);
      }
      const shuffled = [...options].sort(() => Math.random() - 0.5);

      const optsEl = document.getElementById('clockquizOpts');
      optsEl.innerHTML = '';
      shuffled.forEach(h => {
        const btn = document.createElement('button');
        btn.className = 'clockquiz-opt';
        btn.textContent = `${h}„Åò`;
        btn.onclick = () => checkClockQuiz(h, btn);
        optsEl.appendChild(btn);
      });

      document.getElementById('clockquizQ').textContent = '„Åì„ÅÆ„Å®„Åë„ÅÑ„ÄÅ„Å™„Çì„ÅòÔºü';
      document.getElementById('clockquizResult').textContent = '';
    }

    function checkClockQuiz(h, btn) {
      if (cqLocked) return;

      if (h === cqAnswer) {
        cqLocked = true;
        cqStreak++;
        btn.classList.add('correct');
        playSound('correct');
        document.getElementById('clockquizResult').textContent = '‚≠ê „Åô„Åî„ÅÑÔºÅ„Åõ„ÅÑ„Åã„ÅÑÔºÅ ‚≠ê';
        document.getElementById('clockquizClock').querySelectorAll('.clock-number').forEach(n => {
          if (parseInt(n.dataset.num) === cqAnswer) n.classList.add('highlight');
        });
        spawnStarsAt(btn.getBoundingClientRect().left + btn.getBoundingClientRect().width / 2,
                      btn.getBoundingClientRect().top + btn.getBoundingClientRect().height / 2);
        document.getElementById('clockquizScore').textContent = '‚≠ê'.repeat(Math.min(cqStreak, 20));

        if (cqStreak % 3 === 0) addStamp();

        setTimeout(nextClockQuiz, 2000);
      } else {
        btn.classList.add('wrong');
        playSound('wrong');
        document.getElementById('clockquizResult').textContent = '„Åä„Åó„ÅÑÔºÅ„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑÔºÅ';
        setTimeout(() => btn.classList.remove('wrong'), 500);
      }
    }

    /* ===== „ÅÑ„Çç„ÅÇ„Å¶„ÇØ„Ç§„Ç∫ ===== */
    const COLORS = [
      { name: '„ÅÇ„Åã', color: '#e53935' },
      { name: '„ÅÇ„Åä', color: '#1e88e5' },
      { name: '„Åç„ÅÑ„Çç', color: '#fdd835' },
      { name: '„Åø„Å©„Çä', color: '#43a047' },
      { name: '„Ç™„É¨„É≥„Ç∏', color: '#fb8c00' },
      { name: '„ÇÄ„Çâ„Åï„Åç', color: '#8e24aa' },
      { name: '„Éî„É≥„ÇØ', color: '#ec407a' },
      { name: '„Å°„ÇÉ„ÅÑ„Çç', color: '#795548' },
    ];

    let colorAnswer = null;
    let colorStreak = 0;
    let colorLocked = false;

    function startColorQuiz() {
      colorStreak = 0;
      document.getElementById('colorquizScore').textContent = '';
      nextColorQuiz();
    }

    function nextColorQuiz() {
      colorLocked = false;
      const idx = Math.floor(Math.random() * COLORS.length);
      colorAnswer = idx;

      document.getElementById('colorTarget').style.background = COLORS[idx].color;

      const options = new Set([idx]);
      while (options.size < 4) {
        options.add(Math.floor(Math.random() * COLORS.length));
      }
      const shuffled = [...options].sort(() => Math.random() - 0.5);

      const optsEl = document.getElementById('colorOpts');
      optsEl.innerHTML = '';
      shuffled.forEach(i => {
        const btn = document.createElement('button');
        btn.className = 'color-opt';
        btn.textContent = COLORS[i].name;
        btn.style.color = COLORS[i].color;
        btn.onclick = () => checkColor(i, btn);
        optsEl.appendChild(btn);
      });

      document.getElementById('colorquizQ').textContent = '„Åì„ÅÆ„ÅÑ„Çç„ÄÅ„Å™„Éº„Çì„Å†Ôºü';
      document.getElementById('colorquizResult').textContent = '';
    }

    function checkColor(i, btn) {
      if (colorLocked) return;

      if (i === colorAnswer) {
        colorLocked = true;
        colorStreak++;
        btn.classList.add('correct');
        playSound('correct');
        document.getElementById('colorquizResult').textContent = '‚≠ê „Åõ„ÅÑ„Åã„ÅÑÔºÅ ‚≠ê';
        spawnStarsAt(btn.getBoundingClientRect().left + btn.getBoundingClientRect().width / 2,
                      btn.getBoundingClientRect().top + btn.getBoundingClientRect().height / 2);
        document.getElementById('colorquizScore').textContent = '‚≠ê'.repeat(Math.min(colorStreak, 20));

        if (colorStreak % 3 === 0) addStamp();

        setTimeout(nextColorQuiz, 1800);
      } else {
        btn.classList.add('wrong');
        playSound('wrong');
        document.getElementById('colorquizResult').textContent = '„Åä„Åó„ÅÑÔºÅ„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑÔºÅ';
        setTimeout(() => btn.classList.remove('wrong'), 500);
      }
    }

    /* ===== „Åò„ÇÖ„Çì„Å∞„Çì„Å™„Çâ„Åπ ===== */
    let orderNums = [];
    let orderCurrent = 0;
    let orderStreak = 0;
    let orderLocked = false;

    function startOrder() {
      orderStreak = 0;
      document.getElementById('orderScore').textContent = '';
      nextOrder();
    }

    function nextOrder() {
      orderLocked = false;
      orderCurrent = 0;

      // 3„Äú5ÂÄã„ÅÆÊï∞Â≠óÔºà3Ê≠≥Âêë„Åë„Å™„ÅÆ„ÅßÂ∞ë„Å™„ÇÅÔºâ
      const count = 3 + Math.min(Math.floor(orderStreak / 2), 2);
      const all = [];
      for (let i = 1; i <= 12; i++) all.push(i);
      // „Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶ÊúÄÂàù„ÅÆcountÂÄã
      all.sort(() => Math.random() - 0.5);
      orderNums = all.slice(0, count).sort((a, b) => a - b);

      // „Çπ„É≠„ÉÉ„Éà
      const slotsEl = document.getElementById('orderSlots');
      slotsEl.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const slot = document.createElement('div');
        slot.className = 'order-slot';
        slot.dataset.idx = i;
        slotsEl.appendChild(slot);
      }

      // ÈÅ∏ÊäûËÇ¢Ôºà„Ç∑„É£„ÉÉ„Éï„É´Ôºâ
      const shuffled = [...orderNums].sort(() => Math.random() - 0.5);
      const choicesEl = document.getElementById('orderChoices');
      choicesEl.innerHTML = '';
      shuffled.forEach(n => {
        const btn = document.createElement('div');
        btn.className = 'order-choice';
        btn.textContent = n;
        btn.dataset.num = n;
        btn.onclick = () => checkOrder(n, btn);
        choicesEl.appendChild(btn);
      });

      document.getElementById('orderTitle').textContent = '„Å°„ÅÑ„Åï„ÅÑ„Åò„ÇÖ„Çì„Å´ „Å™„Çâ„Åπ„Å¶„Å≠ÔºÅ';
      document.getElementById('orderResult').textContent = '';
    }

    function checkOrder(num, btn) {
      if (orderLocked) return;

      if (num === orderNums[orderCurrent]) {
        // Ê≠£Ëß£
        btn.classList.add('used');
        playSound('tap');

        const slots = document.querySelectorAll('#orderSlots .order-slot');
        slots[orderCurrent].textContent = num;
        slots[orderCurrent].classList.add('filled');

        orderCurrent++;

        if (orderCurrent === orderNums.length) {
          // ÂÖ®ÈÉ®‰∏¶„Åπ„ÅüÔºÅ
          orderLocked = true;
          orderStreak++;
          playSound('correct');
          document.getElementById('orderResult').textContent = '‚≠ê „Åã„Çì„Å∫„ÅçÔºÅ ‚≠ê';
          spawnConfetti();
          document.getElementById('orderScore').textContent = '‚≠ê'.repeat(Math.min(orderStreak, 20));

          if (orderStreak % 2 === 0) addStamp();

          setTimeout(nextOrder, 2500);
        }
      } else {
        // ‰∏çÊ≠£Ëß£
        playSound('wrong');
        const slots = document.querySelectorAll('#orderSlots .order-slot');
        slots[orderCurrent].classList.add('wrong-slot');
        setTimeout(() => slots[orderCurrent].classList.remove('wrong-slot'), 400);
        document.getElementById('orderResult').textContent = '„ÇÇ„Å£„Å®„Å°„ÅÑ„Åï„ÅÑ„ÅÆ„ÅØÔºüü§î';
      }
    }

    /* ===== ÂàùÊúüÂåñ ===== */
    loadStamps();
  </script>
</body>
</html>
